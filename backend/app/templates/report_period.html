{% extends 'base.html' %}
{% block title %}Отчёт за период{% endblock title %}
{% block content %}
<div class="container">
    <div class="row align-items-center justify-content-center">
        <div class="col-md-6">
            <h1 class="text-center">Выберите даты за которые необходимо сформировать отчёт</h1>
            <form id="report_form" class="form-control">
                <div class="mb-3">
                    <label for="start_date" class="form-label">Отчет с:</label>
                    <input type="date" name="start_date" class="form-control" >
                </div>
                <div class="mb-3">
                    <label for="end_date" class="form-label">Отчёт по:</label>
                    <input type="date" name="end_date" class="form-control">
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <input type="button" id="generate_report" value="Сформировать отчёт">
                </div>
            </form>
            <script>
                $(document).ready(function(){
                    Telegram.WebApp.ready()
                    var WebApp = window.Telegram.WebApp
                    WebApp.expand()
                    $('#generate_report').on('click', function(event){
                        event.preventDefault()
                        $.ajax({
                            url: '/users/admin/{{ request.path_params.telegram_id }}/period_report/',
                            method: 'post',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify(
                                {
                                    start_date: $('input[name="start_date"]').val(),
                                    end_date: $('input[name="end_date"]').val(),
                                }
                            ),
                            statusCode: {
                                200: function () {
                                    alert('Отчёт сформирован')
                                    WebApp.close()
                                }
                            }
                        })
                    })
                })
            </script>
        </div>
    </div>
</div>
{% endblock content %}